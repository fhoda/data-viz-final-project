<!DOCTYPE html>

<meta charset="utf-8">
<html>
<head>

  <title>Final Project</title>

  <script src="//cdnjs.cloudflare.com/ajax/libs/vega/3.0.0-beta.33/vega.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-beta.17/vega-embed.js"></script>

  <script src="//d3js.org/d3.v4.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.3/css/bulma.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->

  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://bootswatch.com/darkly/bootstrap.min.css" crossorigin="anonymous">

  <!-- Latest compiled and minified JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script src="https://use.fontawesome.com/836dfd3199.js"></script>

  <script>
    $(document).ready(function(){
        // Add minus icon for collapse element which is open by default
        $(".collapse.in").each(function(){
        	$(this).siblings(".panel-heading").find(".glyphicon").addClass("glyphicon-minus").removeClass("glyphicon-plus");
        });

        // Toggle plus minus icon on show hide of collapse element
        $(".collapse").on('show.bs.collapse', function(){
        	$(this).parent().find(".glyphicon").removeClass("glyphicon-plus").addClass("glyphicon-minus");
        }).on('hide.bs.collapse', function(){
        	$(this).parent().find(".glyphicon").removeClass("glyphicon-minus").addClass("glyphicon-plus");
        });
    });
</script>

  <link rel="stylesheet" type="text/css" href="style.css">
</head>


<body>

  <nav class="navbar navbar-default">
    <div class="container-fluid">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#">CSC 498 Data Visualization Final Project</a>
      </div>

      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#rankings"><i class="fa fa-calendar" aria-hidden="true"></i> Monthly Rank<span class="sr-only">(current)</span></a></li>
          <li><a href="#trend"><i class="fa fa-line-chart" aria-hidden="true"></i> Median Price Trend</a></li>
          <li><a href="#map"><i class="fa fa-map-marker" aria-hidden="true"></i> Zipcode Map</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><i class="fa fa-book" aria-hidden="true"></i> Resources <span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="//www.zillow.com/research/data/"><i class="fa fa-home" aria-hidden="true"></i> Zillow</a></li>
              <li><a href="//d3js.org/">D3.js</a></li>
              <li><a href="//vega.github.io/vega/">Vega</a></li>
              <li class="divider"></li>
              <li><a href="Data.zip"><i class="fa fa-download" aria-hidden="true"></i> Download Datasets</a></li>
              <li class="divider"></li>
              <li><a href="//github.com/fhoda/data-viz-final-project"><i class="fa fa-github" aria-hidden="true"></i> Project Repo</a></li>
            </ul>
          </li>
        </ul>
        <ul class="nav navbar-nav navbar-right">
          <li><a href="#about"><i class="fa fa-info-circle" aria-hidden="true"></i> About</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- <h1>NJ Median Home Prices (2012-2016)</h1>
  <h4>Test</h4> -->
  <div class="container-fluid">
    <div class="jumbotron" id="rankings">
      <h2><i class="fa fa-calendar" aria-hidden="true"></i> Monthly Rankings (2012-2016)</h2>
      <hr>
      <p>For first-time home buyers finding a house is a daunting task that comes with many considerations. This project aims to ease that process for NJ buyers by allowing them to gain insight into Median Price trends.</p>
      <p>The time of year to purchase a house according to most realtors is either before or after the summer. Does this hold true based on price?</p>
      <p>Here are the average rankings for each month based on home prices (lower is better).</p>
    </div>
    <div id="rank"></div>
    <br/><br/>
    <div class="bs-example">
        <!-- <div class="panel-group" id="accordion"> -->
            <div class="panel panel-info" id="rank_accordion">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#rank_accordion" href="#collapse_rank"><span class="glyphicon glyphicon-plus"></span> Visualization Details</a>
                    </h4>
                </div>
                <div id="collapse_rank" class="panel-collapse collapse">
                    <div class="panel-body">
                        <p>HTML stands for HyperText Markup Language. HTML is the main markup language for describing the structure of Web pages. <a href="https://www.tutorialrepublic.com/html-tutorial/" target="_blank">Learn more.</a></p>
                    </div>
                </div>
            </div>
        </div>
    <a href="#trend"><i class="fa fa-angle-double-down fa-5x" aria-hidden="true"></i></a>
    <br/><br/>

    <div class="jumbotron" id="trend">
      <h2><i class="fa fa-line-chart" aria-hidden="true"></i> Average Median Price for Each Month (2012-2016)</h2>
      <p>What are the reasons that home prices are on a steady rise and have very little downturn in given months?</p>
    </div>
    <div id="yearly"></div>
    <br/><br/>
    <div class="bs-example">
        <!-- <div class="panel-group" id="accordion"> -->
            <div class="panel panel-info" id="trend_accordion">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#trend_accordion" href="#collapse_trend"><span class="glyphicon glyphicon-plus"></span> Visualization Details</a>
                    </h4>
                </div>
                <div id="collapse_trend" class="panel-collapse collapse">
                    <div class="panel-body">
                        <p>HTML stands for HyperText Markup Language. HTML is the main markup language for describing the structure of Web pages. <a href="https://www.tutorialrepublic.com/html-tutorial/" target="_blank">Learn more.</a></p>
                    </div>
                </div>
            </div>
        </div>
    <a href="#map"><i class="fa fa-angle-double-down fa-5x" aria-hidden="true"></i></a>
    <br/><br/>


    <div class="jumbotron" id="map">
      <h2><i class="fa fa-map-marker" aria-hidden="true"></i> Map of NJ Zipcodes and Home Prices</h2>
      <p>Explore the trends for a given Zipcode by clicking on the region or hover over it to get summary information.</p>
    </div>
    <div class="row">
      <div id="njmap" class="col-md-1"></div>
      <div id="njmap" class="col-md-5"></div>
      <div id="region" class="col-md-6"></div>
    </div>

    <div class="bs-example">
        <!-- <div class="panel-group" id="accordion"> -->
            <div class="panel panel-info" id="map_accordion">
                <div class="panel-heading">
                    <h4 class="panel-title">
                        <a data-toggle="collapse" data-parent="#map_accordion" href="#collapse_map"><span class="glyphicon glyphicon-plus"></span> Visualization Details</a>
                    </h4>
                </div>
                <div id="collapse_map" class="panel-collapse collapse">
                    <div class="panel-body">
                        <p>HTML stands for HyperText Markup Language. HTML is the main markup language for describing the structure of Web pages. <a href="https://www.tutorialrepublic.com/html-tutorial/" target="_blank">Learn more.</a></p>
                    </div>
                </div>
            </div>
        </div>
    <a href="#about"><i class="fa fa-angle-double-down fa-5x" aria-hidden="true"></i></a>
    <br/><br/>

      <div id="about" class="jumbotron">
        <h2><i class="fa fa-info-circle" aria-hidden="true"></i> About</h2>
        <p>Author: Faisal Hoda</p>
      </div>

    </div>
    <script>
    const rank = "rank.vg.json"
    vega.embed("#rank", rank);

    const yearly = "yearly.vg.json"
    vega.embed("#yearly", yearly);

    var width = 600
    var height = 800;

    var njmap = d3.select("#njmap").append("svg")
    .attr("width", width)
    .attr("height", height);

    var color = d3.scaleLinear()
    .range(['lightblue','darkblue'])
    .domain([0,1539573]);

    var projection = d3.geoAlbers()
    .center([-1,40])
    .rotate([74,0])
    .translate([width/2,height/2])
    .scale(15000);

    var path = d3.geoPath()
    .projection(projection);

    var price = d3.map();


    d3.json("tl_2010_34_zcta500.json", function(error, data) {
      if (error) return console.error(error);

      d3.csv("Zip_Zhvi_4bedroom.csv", function(error,price) {
        // make a dictionary to look up values:
        var lookup = {};
        price.forEach(function(d) { lookup[d.RegionName] = +d.Avg; });
        // console.log(lookup)

        function getRegionData(zip) {
          return price.filter(function(price){ return price.RegionName == zip });
        }


        var tooltipDiv = d3.select("body").append("div")
        .attr("class", "tooltip")
        .style("opacity", 0);

        // add each feature
        njmap.selectAll("path")
        .data(topojson.feature(data, data.objects.tl_2010_34_zcta500).features)
        .enter()
        .append('path')
        .attr('fill',function(d) { return color(lookup[d.properties.ZCTA5CE00] ); })
        .attr("d", path)
        .on("mouseover", function(d) {
          var region = getRegionData(d.properties.ZCTA5CE00)[0];
          if(region != null){
            tooltipDiv.transition()
            .duration(200)
            .style("opacity", .9);
            tooltipDiv .html("$" + lookup[d.properties.ZCTA5CE00] + "<br/>" + "ZIP: " + d.properties.ZCTA5CE00 + "<br/>" + "Metro: " + region.Metro + "<br/>" + "City: " + region.City)
            // .style("left", 100 + "px")
            .style("left", (d3.event.pageX + 25) + "px")
            .style("top", (d3.event.pageY - 28) + "px");
            // .style("top", 100 + "px");
          };
        })
        .on("mouseout", function(d) {
          tooltipDiv.transition()
          .duration(500)
          .style("opacity", 0);
        })
        .on("click", function(d) {

          var regionData = getRegionData(d.properties.ZCTA5CE00)[0]
          if(regionData!=null){
            var parseTime = d3.timeParse("%Y-%m");
            var region = []

            Object.entries(regionData).forEach(function(d){
              if(d[0].includes("2")){
                region.push({"month": parseTime(d[0]), "med_price": +d[1]})
              }
            });

            console.log(region);

            d3.select("#region").selectAll("svg").remove();

            var line = d3.select("#region").append("svg")
            .attr("width", 800).attr("height", 600),
            margin = {top: 200, right: 20, bottom: 30, left: 75},
            width = +line.attr("width") - margin.left - margin.right,
            height = +line.attr("height") - margin.top - margin.bottom,
            g = line.append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")").attr("class", "axis");


            var x = d3.scaleTime().rangeRound([0, width]);
            var y = d3.scaleLinear().rangeRound([height, 0]);

            var line = d3.line()
            .x(function(d) { return x(d.month); })
            .y(function(d) { return y(d.med_price); });

            x.domain(d3.extent(region, function(d) { return d.month; }));
            y.domain(d3.extent(region, function(d) { return d.med_price; }));

            g.append("g").attr("class", "axisColor")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x))
            .select(".domain")
            .remove();

            g.append("g").attr("class", "axisColor")
            .call(d3.axisLeft(y))
            .append("text")
            .attr("fill", "#f2f2f2")
            .attr("transform", "rotate(-90)")
            .attr("y", 6)
            .attr("dy", "1em")
            .attr("text-anchor", "end")
            .text("Price (USD)");

            g.append("path")
            .datum(region)
            .attr("fill", "none")
            .attr("stroke", "#f2f2f2")
            .attr("stroke-linejoin", "round")
            .attr("stroke-linecap", "round")
            .attr("stroke-width", 1.5)
            .attr("d", line);
          }
        });
      })
    });
    </script>
  </body>

  </html>
